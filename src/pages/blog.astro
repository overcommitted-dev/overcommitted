---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import FormattedDate from '../components/FormattedDate';

// Get all blog posts and sort by date (newest first)
const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

const title = 'Blog - Overcommitted';
---

<Layout title={title}>
  <div class="relative z-10 px-8 lg:px-18">
    <h1
      class="mb-4 text-2xl font-bold text-light-text-heading lg:mb-6 lg:text-5xl dark:text-white"
    >
      Blog
    </h1>

    <p class="mb-8 lg:mb-12">
      Insights, tutorials, and thoughts on software engineering from the Overcommitted team and community.
    </p>

    {posts.length === 0 ? (
      <p class="text-center text-gray-500 dark:text-gray-400">
        No blog posts yet. Check back soon!
      </p>
    ) : (
      <div class="space-y-8">
        {posts.map((post) => (
          <article class="border-b border-gray-200 pb-8 dark:border-dark-border">
            <div class="mb-2">
              <FormattedDate date={post.data.publishDate} />
            </div>
            
            <h2 class="mb-3">
              <a 
                href={`/blog/${post.slug}`}
                class="text-xl font-bold text-light-text-heading hover:text-blue-600 lg:text-2xl dark:text-white dark:hover:text-blue-400"
              >
                {post.data.title}
              </a>
            </h2>
            
            <p class="mb-4 text-gray-600 dark:text-gray-300">
              {post.data.description}
            </p>
            
            <div class="flex flex-wrap items-center gap-4">
              <span class="text-sm text-gray-500 dark:text-gray-400">
                By {post.data.author}
              </span>
              
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.map((tag) => (
                    <span class="rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </article>
        ))}
      </div>
    )}
  </div>
</Layout>