---
import { type CollectionEntry, getCollection } from 'astro:content';
import { Schema } from 'astro-seo-schema';
import Layout from '../../layouts/Layout.astro';
import FormattedDate from '../../components/FormattedDate';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter((post) => !post.data.draft)
    .map((post) => ({
      params: { slug: post.slug },
      props: post,
    }));
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await post.render();

const canonicalURL = new URL(`/blog/${post.slug}`, Astro.url);
const title = `${post.data.title} - Overcommitted Blog`;
---

<Layout
  canonicalURL={canonicalURL}
  description={post.data.description}
  title={title}
>
  <Schema
    slot="head"
    item={{
      '@context': 'https://schema.org',
      '@type': 'BlogPosting',
      headline: post.data.title,
      description: post.data.description,
      datePublished: post.data.publishDate.toISOString(),
      author: {
        '@type': 'Person',
        name: post.data.author,
      },
    }}
  />

  <div class="relative z-10 px-8 lg:px-18">
    <article class="max-w-4xl">
      <header class="mb-8 lg:mb-12">
        <div class="mb-4">
          <FormattedDate date={post.data.publishDate} />
        </div>
        
        <h1
          class="mb-4 text-2xl font-bold text-light-text-heading lg:mb-6 lg:text-5xl dark:text-white"
        >
          {post.data.title}
        </h1>
        
        <p class="mb-6 text-lg text-gray-600 dark:text-gray-300">
          {post.data.description}
        </p>
        
        <div class="flex flex-wrap items-center gap-4">
          <span class="text-sm text-gray-500 dark:text-gray-400">
            By {post.data.author}
          </span>
          
          {post.data.tags && post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {post.data.tags.map((tag) => (
                <span class="rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </div>
      </header>
      
      <div
        class="prose prose-lg prose-neutral max-w-none dark:prose-invert prose-headings:text-light-text-heading prose-headings:dark:text-white prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline dark:prose-a:text-blue-400"
      >
        <Content />
      </div>
      
      <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
        <div class="text-center">
          <p class="mb-4 text-gray-600 dark:text-gray-300">
            Enjoyed this post? Let us know!
          </p>
          <div class="flex justify-center gap-4">
            <a 
              href="/contact"
              class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600"
            >
              Get in Touch
            </a>
            <a 
              href="/blog"
              class="rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800"
            >
              Back to Blog
            </a>
          </div>
        </div>
      </footer>
    </article>
  </div>
</Layout>